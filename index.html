<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="description" content="Text Tools that can encode and decode UTF-8 string.">
    <meta name="theme-color" content="#0D6EFD">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Text Tools">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="application-name" content="Text Tools">
    <meta name="full-screen" content="yes">
    <meta name="browsermode" content="application">
    <meta name="nightmode" content="enable">

    <title>Text Tools</title>
    <link href="./assets/images/favicon.ico" rel="icon" type="image/x-icon">
    <link href="./assets/images/apple-touch-icon.png" rel="apple-touch-icon">
    <link href="./assets/images/icon-192.png" rel="icon" sizes="192x192">
    <link href="./assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="./assets/css/bootstrap-icons.css" rel="stylesheet">
    <link href="./manifest.json" rel="manifest">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: "Inter", sans-serif;
            font-optical-sizing: auto;
            font-style: normal;
            font-variation-settings: "slnt" 0;
        }
    </style>

    <script type="text/javascript">
        const updateThemeIcon = (theme) => {
            const themeIcon = document.getElementById("themeIcon");
            if (theme == 'dark') {
                themeIcon.classList.remove('bi-sun-fill');
                themeIcon.classList.add('bi-moon-stars-fill');
            } else {
                themeIcon.classList.remove('bi-moon-stars-fill');
                themeIcon.classList.add('bi-sun-fill');
            }
        }

        const setTheme = (theme) => {
            document.documentElement.setAttribute('data-bs-theme', theme);
            localStorage.setItem('theme', theme);
        }

        let theme = localStorage.getItem('theme') ?? 'light';
        setTheme(theme);
    </script>
</head>

<body>
    <nav style="user-select: none;" class="navbar navbar-expand-md bg-primary sticky-top">
        <div class="container-fluid">
            <div style="min-width: 10rem; min-height: 2rem;" id="toolName" class="px-3 py-1 text-white me-2 fs-5"></div>
            <div>
                <button class="btn btn-primary d-md-none" data-clipboard-target="#textOutput">
                    <i class="bi bi-clipboard"></i>
                </button>
                <button class="btn btn-primary d-md-none" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <i class="bi bi-three-dots-vertical text-white"></i>
                </button>
            </div>
            
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0 px-3">
                    <li class="nav-item dropdown">
                        <div class="text-white nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Encoders / Decoders
                        </div>
                        <ul class="dropdown-menu">
                            <li>
                                <div class="dropdown-item" onclick="changeTool('Base64', 'Encode')">Base64 Encode</div>
                            </li>
                            <li>
                                <div class="dropdown-item" onclick="changeTool('Base64', 'Decode')">Base64 Decode</div>
                            </li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li>
                                <div class="dropdown-item" onclick="changeTool('Binary', 'Encode')">Binary Encode</div>
                            </li>
                            <li>
                                <div class="dropdown-item" onclick="changeTool('Binary', 'Decode')">Binary Decode</div>
                            </li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li>
                                <div class="dropdown-item" onclick="changeTool('Hex', 'Encode')">Hex Encode</div>
                            </li>
                            <li>
                                <div class="dropdown-item" onclick="changeTool('Hex', 'Decode')">Hex Decode</div>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <div class="text-white nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Encryptors / Decryptors
                        </div>
                        <ul class="dropdown-menu">
                            <li>
                                <div class="dropdown-item" onclick="changeTool('Base64 Xor', 'Encode')">Base64 Xor
                                    Encode</div>
                            </li>
                            <li>
                                <div class="dropdown-item" onclick="changeTool('Base64 Xor', 'Decode')">Base64 Xor
                                    Decode</div>
                            </li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li>
                                <div class="dropdown-item" onclick="changeTool('AES256', 'Encode')">AES256 Encode</div>
                            </li>
                            <li>
                                <div class="dropdown-item" onclick="changeTool('AES256', 'Decode')">AES256 Decode</div>
                            </li>
                        </ul>
                    </li>
                </ul>
                <button class="btn btn-primary d-none d-md-block" data-clipboard-target="#textOutput">
                    <i class="bi bi-clipboard"></i>
                </button>
                <a class="ms-2 btn btn-primary" target="_blank" href="https://github.com/kaungkhantjc/text-tools">
                    <i class="bi bi-github"></i>
                </a>
                <button class="btn btn-primary" onclick="changeTheme()">
                    <i id="themeIcon" class="bi bi-moon-stars-fill"></i>
                </button>

                <script type="text/javascript">
                    updateThemeIcon(theme);
                </script>
            </div>
        </div>
    </nav>

    <main>
        <div id="boxPassword" class="mt-3 mx-3 d-none">
            <div class="input-group">
                <span class="input-group-text" id="iconPassword"><i class="bi bi-key-fill"></i></span>
                <input autocomplete="off" spellcheck="false" type="text" class="form-control" id="textPassword"
                    placeholder="Password" aria-label="Password" aria-describedby="iconPassword">
            </div>
        </div>

        <div class="row m-0 gy-3 mb-3">
            <div class="col-md-6">
                <div>
                    <textarea placeholder="Input text" spellcheck="false" class="form-control" id="textInput"
                        rows="16"></textarea>
                    <div id="inputTextLinesAndChars" class="font-monospace mx-1 my-2">1 lines, 0 characters</div>
                </div>
            </div>
            <div class="col-md-6">
                <div>
                    <textarea placeholder="Output text" spellcheck="false" class="form-control" id="textOutput"
                    rows="16"></textarea>
                    <div id="outputTextLinesAndChars" class="font-monospace mx-1 my-2">1 lines, 0 characters</div>
                </div>
            </div>
        </div>

    </main>

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="toastBoxTextCopied" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-body">
                <i class="bi bi-clipboard-check-fill text-success"></i>
                <span class="ms-2">Output text copied.</span>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="./assets/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="./assets/js/clipboard.min.js"></script>
    <script type="text/javascript" src="./assets/js/base64.min.js"></script>
    <script type="text/javascript" src="./assets/js/AES256.min.js"></script>

    <script type="text/javascript">

        const encodeBase64 = (text) => Base64.encode(text);
        const decodeBase64 = (text) => Base64.decode(text);

        const textToBinary = (text) => text.split('').map(char => char.charCodeAt(0).toString(2).padStart(8, '0')).join(' ');
        const binaryToText = (binary) => String.fromCharCode(...binary.split(' ').map(byte => parseInt(byte, 2)));

        const encryptAES256 = (text, password) => AES256.encrypt(text, password);
        const decryptAES256 = (text, password) => AES256.decrypt(text, password);

        const xorString = (text, key) => {
            let result = '';
            for (let i = 0; i < text.length; i++) {
                result += String.fromCharCode(text.charCodeAt(i) ^ key.charCodeAt(i % key.length));
            }
            return result;
        };

        const encryptXor = (text, password) => encodeBase64(xorString(text, password));
        const decryptXor = (text, password) => xorString(decodeBase64(text), password);

        const encodeHex = (text) => {
            let hex, i;

            let result = "";
            for (i = 0; i < text.length; i++) {
                hex = text.charCodeAt(i).toString(16);
                result += ("000" + hex).slice(-4);
            }
            return result
        }

        const decodeHex = (text) => {
            let j;
            let hexes = text.match(/.{1,4}/g) || [];
            let back = "";
            for (j = 0; j < hexes.length; j++) {
                back += String.fromCharCode(parseInt(hexes[j], 16));
            }

            return back;
        }

    </script>

    <script type="text/javascript">
        const navLinks = document.querySelectorAll('div#navbarSupportedContent .nav-item .dropdown-item');
        const menuToggle = document.getElementById('navbarSupportedContent');
        const bsCollapse = bootstrap.Collapse.getOrCreateInstance(menuToggle, { toggle: false });
        navLinks.forEach((l) => {
            l.addEventListener('click', () => { bsCollapse.hide() })
        });
    </script>

    <script type="text/javascript">

        const changeTheme = () => {
            theme = theme == 'light' ? 'dark' : 'light';
            setTheme(theme);
            updateThemeIcon(theme);
        }

        const toastBoxTextCopied = document.getElementById('toastBoxTextCopied');
        const toastTextCopied = bootstrap.Toast.getOrCreateInstance(toastBoxTextCopied);

        const clipboard = new ClipboardJS('.btn');
        clipboard.on('success', (e) => {
            e.clearSelection();
            toastTextCopied.show();
        })
        .on('error', () => {
            textOutput.blur();
        });

        const toolName = document.getElementById("toolName");
        const textInput = document.getElementById("textInput");
        const textPassword = document.getElementById("textPassword");
        const textOutput = document.getElementById("textOutput");
        const boxPassword = document.getElementById("boxPassword");
        const inputTextLinesAndChars = document.getElementById("inputTextLinesAndChars");
        const outputTextLinesAndChars = document.getElementById("outputTextLinesAndChars");

        let currentTool = null;
        let currentMode = null;

        const getInputText = () => textInput.value;
        const getOutputText = () => textOutput.value;
        const getPassword = () => textPassword.value;
        const getStoredPassword = () => localStorage.getItem(`password_for_${currentTool}`);
        const getTool = () => localStorage.getItem('tool') ?? "Base64";
        const getMode = () => localStorage.getItem('mode') ?? "Encode";

        const setToolName = (text) => toolName.innerText = text;
        const setOutputText = (text) => textOutput.value = text;
        const setPasswordText = (text) => textPassword.value = text;
        const setPasswordBoxHidden = (hidden) => boxPassword.classList.toggle('d-none', hidden);
        const setStoredPassword = (password) => localStorage.setItem(`password_for_${currentTool}`, password);
        const setToolAndMode = () => {
            localStorage.setItem('tool', currentTool);
            localStorage.setItem('mode', currentMode);
        }
        const setLinesAndChars = (element, text) => {
            const characters = text.length;
            const lines = text.split('\n').length;
            element.innerText = `${lines} lines, ${characters} characters`;
        }

        const setOutputTextSafely = (func) => {
            try {
                setOutputText(func());
                setLinesAndChars(outputTextLinesAndChars, getOutputText());
            } catch (e) {
                setOutputText(e)
            }
        }

        const changeTool = (tool, mode) => {
            currentTool = tool;
            currentMode = mode;

            const storedPassword = getStoredPassword();
            if (storedPassword != null) {
                setPasswordText(storedPassword);
            }

            setToolAndMode();
            setPasswordBoxHidden(['Base64', 'Binary', 'Hex'].includes(currentTool));
            processTool();
        }

        const processTool = () => {
            const toolName = `${currentTool} - ${currentMode}`;
            setToolName(toolName);

            const inputText = getInputText();

            if (inputText.length == 0) {
                setOutputText("");
                return;
            }

            switch (currentTool) {
                case "Base64":
                    setOutputTextSafely(() => currentMode == 'Encode' ? encodeBase64(inputText) : decodeBase64(inputText));
                    break;

                case "Binary":
                    setOutputTextSafely(() => currentMode == 'Encode' ? textToBinary(inputText) : binaryToText(inputText));
                    break;

                case "Hex":
                    setOutputTextSafely(() => currentMode == 'Encode' ? encodeHex(inputText) : decodeHex(inputText));
                    break;

                case "AES256":
                    var password = getPassword();
                    if (password.length > 0) setOutputTextSafely(() => currentMode == 'Encode' ? encryptAES256(inputText, password) : decryptAES256(inputText, password));
                    break;

                case "Base64 Xor":
                    var password = getPassword();
                    if (password.length > 0) setOutputTextSafely(() => currentMode == 'Encode' ? encryptXor(inputText, password) : decryptXor(inputText, password));
                    break;
            }
        }

        textInput.addEventListener('input', () => {
            setLinesAndChars(inputTextLinesAndChars, getInputText());
            processTool();
        });

        textPassword.addEventListener('input', () => {
            setStoredPassword(getPassword());
            processTool();
        });

        changeTool(getTool(), getMode());

    </script>
</body>

</html>